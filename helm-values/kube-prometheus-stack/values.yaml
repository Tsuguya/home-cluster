prometheus:
  prometheusSpec:
    retention: 14d
    resources:
      limits:
        memory: 2Gi
      requests:
        cpu: 200m
        memory: 1Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: ceph-block
          resources:
            requests:
              storage: 20Gi

grafana:
  adminPassword: prom-operator # unused: login form disabled, Dex SSO only. Pinned to prevent OutOfSync.
  grafana.ini:
    database:
      type: postgres
      host: shared-pg-rw.database.svc:5432
      name: grafana
    server:
      root_url: https://grafana.infra.tgy.io
    auth:
      disable_login_form: true
    auth.generic_oauth:
      enabled: true
      name: Dex
      client_id: grafana-sso
      scopes: openid profile email
      auth_url: https://argocd.infra.tgy.io/api/dex/auth
      token_url: https://argocd.infra.tgy.io/api/dex/token
      api_url: https://argocd.infra.tgy.io/api/dex/userinfo
      tls_skip_verify_insecure: true
      allowed_domains: tgy.io
      allow_sign_up: true
      auto_login: true
      role_attribute_path: "'Admin'"
  envValueFrom:
    GF_DATABASE_USER:
      secretKeyRef:
        name: grafana-pg-credentials
        key: username
    GF_DATABASE_PASSWORD:
      secretKeyRef:
        name: grafana-pg-credentials
        key: password
    GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET:
      secretKeyRef:
        name: grafana-sso
        key: clientSecret
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki-gateway.monitoring.svc:80
      access: proxy
      isDefault: false

alertmanager:
  alertmanagerSpec:
    automountServiceAccountToken: false
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
