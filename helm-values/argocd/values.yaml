global:
  logging:
    format: json

configs:
  cm:
    resource.exclusions: |
      - apiGroups:
          - cilium.io
        kinds:
          - CiliumIdentity
        clusters:
          - "*"
    admin.enabled: "false"
    url: https://argocd.infra.tgy.io
    dex.config: |
      connectors:
        - type: oidc
          id: google
          name: Google
          config:
            issuer: https://accounts.google.com
            clientID: $GOOGLE_CLIENT_ID
            clientSecret: $GOOGLE_CLIENT_SECRET
            requestedScopes:
              - openid
              - profile
              - email
  rbac:
    policy.csv: |
      g, tsuguya.toma@tgy.io, role:admin
    policy.default: ""
    scopes: "[email]"
  params:
    server.insecure: "true"

dex:
  env:
    - name: GOOGLE_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: argocd-google-oauth
          key: clientID
    - name: GOOGLE_CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: argocd-google-oauth
          key: clientSecret

repoServer:
  livenessProbe:
    enabled: false

redis:
  automountServiceAccountToken: false

server:
  httproute:
    enabled: true
    parentRefs:
      - group: gateway.networking.k8s.io
        kind: Gateway
        name: main-gateway
        namespace: gateway
        sectionName: https
    hostnames:
      - argocd.infra.tgy.io
  grpcroute:
    enabled: true
    parentRefs:
      - group: gateway.networking.k8s.io
        kind: Gateway
        name: main-gateway
        namespace: gateway
        sectionName: https
    hostnames:
      - argocd.infra.tgy.io
    rules:
      - matches:
          - method:
              type: RegularExpression
              service: ".*"
