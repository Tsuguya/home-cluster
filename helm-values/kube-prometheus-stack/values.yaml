kubeProxy:
  enabled: false

prometheusOperator:
  logFormat: json

prometheus:
  prometheusSpec:
    logFormat: json
    retention: 14d
    resources:
      limits:
        memory: 2Gi
      requests:
        cpu: 200m
        memory: 1Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: ceph-block
          resources:
            requests:
              storage: 20Gi

grafana:
  adminPassword: prom-operator # unused: login form disabled, SSO only. Pinned to prevent OutOfSync.
  grafana.ini:
    log:
      mode: console
    log.console:
      format: json
    database:
      type: postgres
      host: shared-pg-rw.database.svc:5432
      name: grafana
    dashboards:
      default_home_dashboard_path: /tmp/dashboards/pod-resources.json
    server:
      root_url: https://grafana.infra.tgy.io
    auth:
      disable_login_form: true
    auth.generic_oauth:
      enabled: true
      name: Google
      scopes: openid profile email
      auth_url: https://accounts.google.com/o/oauth2/v2/auth
      token_url: https://oauth2.googleapis.com/token
      api_url: https://openidconnect.googleapis.com/v1/userinfo
      email_attribute_path: email
      login_attribute_path: email
      name_attribute_path: name
      allowed_domains: tgy.io
      allow_sign_up: true
      auto_login: true
      role_attribute_path: "'Admin'"
  envValueFrom:
    GF_DATABASE_USER:
      secretKeyRef:
        name: grafana-pg-credentials
        key: username
    GF_DATABASE_PASSWORD:
      secretKeyRef:
        name: grafana-pg-credentials
        key: password
    GF_AUTH_GENERIC_OAUTH_CLIENT_ID:
      secretKeyRef:
        name: google-oauth
        key: clientID
    GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET:
      secretKeyRef:
        name: google-oauth
        key: clientSecret
    GF_DISCORD_WEBHOOK_URL:
      secretKeyRef:
        name: discord-webhook-grafana
        key: url
  alerting:
    contactpoints.yaml:
      apiVersion: 1
      contactPoints:
        - orgId: 1
          name: discord
          receivers:
            - uid: discord
              type: discord
              settings:
                url: $__env{GF_DISCORD_WEBHOOK_URL}
                use_discord_username: true
    policies.yaml:
      apiVersion: 1
      policies:
        - orgId: 1
          receiver: discord
          group_by: ['grafana_folder', 'alertname']
          group_wait: 30s
          group_interval: 5m
          repeat_interval: 4h
  additionalDataSources:
    - name: Loki
      uid: loki
      type: loki
      url: http://loki-gateway.monitoring.svc:80
      access: proxy
      isDefault: false

alertmanager:
  alertmanagerSpec:
    logFormat: json
    automountServiceAccountToken: false
    alertmanagerConfiguration:
      name: discord
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
