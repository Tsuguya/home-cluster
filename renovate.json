{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "argocd": {
    "managerFilePatterns": ["/apps/.+\\.yaml$/"]
  },
  "kubernetes": {
    "managerFilePatterns": ["/manifests/.+\\.yaml$/", "/kustomize/.+\\.yaml$/"]
  },
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["/kustomize/qnap-csi/upstream\\.yaml$"],
      "matchStrings": [
        "# upstream: qnap-dev/QNAP-CSI-PlugIn@(?<currentValue>v\\S+)"
      ],
      "datasourceTemplate": "github-tags",
      "packageNameTemplate": "qnap-dev/QNAP-CSI-PlugIn"
    },
    {
      "customType": "regex",
      "managerFilePatterns": ["/kustomize/qnap-csi/upstream\\.yaml$"],
      "matchStrings": [
        "--qts-cgi-image=(?<depName>[^:]+):(?<currentValue>v\\S+)"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "managerFilePatterns": ["/kustomize/qnap-csi/upstream\\.yaml$"],
      "matchStrings": [
        "tridentImage: (?<depName>[^:]+):(?<currentValue>v\\S+)"
      ],
      "datasourceTemplate": "docker"
    }
  ],
  "packageRules": [
    {
      "description": "Automerge patch updates",
      "matchUpdateTypes": ["patch", "digest"],
      "automerge": true
    },
    {
      "description": "Automerge Docker image minor updates",
      "matchDatasources": ["docker"],
      "matchUpdateTypes": ["minor"],
      "automerge": true
    },
    {
      "description": "Do not automerge critical infrastructure",
      "matchPackageNames": ["cilium", "tetragon"],
      "automerge": false
    },
    {
      "description": "Group QNAP CSI packages (chart version + all images)",
      "matchPackagePatterns": ["qnap-dev/QNAP-CSI-PlugIn", "qnapsystem/"],
      "groupName": "qnap-csi"
    },
    {
      "description": "Group seaweedfs packages",
      "matchPackagePatterns": ["seaweedfs"],
      "groupName": "seaweedfs"
    }
  ]
}
